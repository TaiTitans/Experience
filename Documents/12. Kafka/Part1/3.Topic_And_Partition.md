
---
## ‚úÖ **Topic l√† g√¨?**

- **Topic** l√† n∆°i ch·ª©a message trong Kafka, gi·ªëng nh∆∞ **m·ªôt k√™nh** m√† Producer g·ª≠i message v√†o v√† Consumer ƒë·ªçc message t·ª´ ƒë√≥.
- Kafka kh√¥ng quan t√¢m ƒë·∫øn n·ªôi dung message, ch·ªâ l∆∞u v√† ph√¢n ph·ªëi message theo **topic**.
- **V√≠ d·ª•:**
    - `order-topic` ‚Üí Ch·ª©a th√¥ng tin ƒë∆°n h√†ng.
    - `payment-topic` ‚Üí Ch·ª©a th√¥ng tin thanh to√°n.
    - `notification-topic` ‚Üí Ch·ª©a th√¥ng b√°o g·ª≠i ƒë·∫øn kh√°ch h√†ng.

---

## ‚úÖ **C√°ch t·ªï ch·ª©c topic trong Kafka**

- M·ªói topic c√≥ th·ªÉ c√≥ nhi·ªÅu **partition** (xem ph·∫ßn 4Ô∏è‚É£ Partition).
- Topic ƒë∆∞·ª£c l∆∞u tr·ªØ tr√™n **nhi·ªÅu broker** trong cluster.
- Producer ghi d·ªØ li·ªáu v√†o topic, Consumer ƒë·ªçc d·ªØ li·ªáu t·ª´ topic.

---

## ‚úÖ **C√°ch t·∫°o topic trong Kafka**

C√≥ th·ªÉ t·∫°o topic b·∫±ng **Kafka CLI** ho·∫∑c **code Java
```java
kafka-topics.sh --create \
  --topic order-topic \
  --bootstrap-server localhost:9092 \
  --partitions 3 \
  --replication-factor 2
```

- `--partitions 3` ‚Üí Topic c√≥ 3 partition.
- `--replication-factor 2` ‚Üí M·ªói partition c√≥ 2 b·∫£n sao (replica).

### üîπ **T·∫°o topic b·∫±ng Java**

S·ª≠ d·ª•ng **AdminClient API** c·ªßa Kafka:

```java
Properties props = new Properties();
props.put(AdminClientConfig.BOOTSTRAP_SERVERS_CONFIG, "localhost:9092");
try (AdminClient adminClient = AdminClient.create(props)) {
    NewTopic newTopic = new NewTopic("order-topic", 3, (short) 2); // 3 partition, replication factor = 2
    adminClient.createTopics(Collections.singletonList(newTopic));
}
```

## ‚úÖ **X√≥a topic trong Kafka**

L·ªánh x√≥a topic b·∫±ng CLI:
```java
kafka-topics.sh --delete --topic order-topic --bootstrap-server localhost:9092
```

- Kafka kh√¥ng x√≥a ngay l·∫≠p t·ª©c m√† ch·ªâ **ƒë√°nh d·∫•u topic b·ªã x√≥a**, t√πy v√†o c·∫•u h√¨nh `delete.topic.enable`.

## ‚úÖ **Retention Policy c·ªßa Topic**

- Kafka c√≥ th·ªÉ gi·ªØ message **trong m·ªôt kho·∫£ng th·ªùi gian** ho·∫∑c **theo dung l∆∞·ª£ng**.
- **C·∫•u h√¨nh retention policy** cho t·ª´ng topic:

```java
kafka-configs.sh --alter --entity-type topics --entity-name order-topic \
  --add-config retention.ms=604800000
```

- `retention.ms=604800000` ‚Üí Gi·ªØ message trong 7 ng√†y.

## ‚úÖ **T√≥m t·∫Øt v·ªÅ Topic**

- **Topic l√† n∆°i ch·ª©a message**, c√≥ th·ªÉ c√≥ nhi·ªÅu partition ƒë·ªÉ scale.
- **Topic c√≥ th·ªÉ ƒë∆∞·ª£c t·∫°o ho·∫∑c x√≥a b·∫±ng CLI ho·∫∑c Java API**.
- **Retention Policy gi√∫p Kafka t·ª± ƒë·ªông x√≥a message c≈©**.

üöÄ **Ti·∫øp theo: Partition - Chia nh·ªè d·ªØ li·ªáu ƒë·ªÉ Kafka c√≥ th·ªÉ scale t·ªët h∆°n!**


---

# **4Ô∏è‚É£ Partition trong Kafka**

## ‚úÖ **Partition l√† g√¨?**

- **Partition l√† ƒë∆°n v·ªã l∆∞u tr·ªØ nh·ªè nh·∫•t trong Kafka**, gi√∫p **chia nh·ªè topic** ƒë·ªÉ **scale horizontally**.
- M·ªói topic c√≥ th·ªÉ c√≥ **nhi·ªÅu partition**, v√† m·ªói partition c√≥ th·ªÉ ƒë∆∞·ª£c l∆∞u tr·ªØ tr√™n c√°c broker kh√°c nhau.

**V√≠ d·ª•:**  
Gi·∫£ s·ª≠ topic `order-topic` c√≥ 3 partition:

|Partition|Broker|
|---|---|
|`order-topic-0`|`Broker 1`|
|`order-topic-1`|`Broker 2`|
|`order-topic-2`|`Broker 3`|

- Khi Producer g·ª≠i message, Kafka s·∫Ω quy·∫øt ƒë·ªãnh **message n√†o s·∫Ω v√†o partition n√†o**.
- Consumer s·∫Ω ƒë·ªçc d·ªØ li·ªáu theo t·ª´ng partition.

## ‚úÖ **T·∫°i sao Partition quan tr·ªçng?**

### **1Ô∏è‚É£ Gi√∫p Kafka Scale Horizontally**

- N·∫øu ch·ªâ c√≥ 1 partition, to√†n b·ªô message c·ªßa topic s·∫Ω n·∫±m tr√™n **1 broker**, g√¢y gi·ªõi h·∫°n hi·ªáu su·∫•t.
- Khi c√≥ nhi·ªÅu partition, d·ªØ li·ªáu ƒë∆∞·ª£c **ph√¢n t√°n** tr√™n nhi·ªÅu broker, gi√∫p **tƒÉng throughput**.

### **2Ô∏è‚É£ H·ªó tr·ª£ song song (Parallel Processing)**

- M·ªói partition c√≥ th·ªÉ ƒë∆∞·ª£c x·ª≠ l√Ω b·ªüi **nhi·ªÅu Consumer kh√°c nhau** trong c√πng m·ªôt **Consumer Group**.
- N·∫øu c√≥ 3 partition, Kafka c√≥ th·ªÉ x·ª≠ l√Ω message b·∫±ng **3 Consumer song song**

## ‚úÖ **C√°ch Kafka ph√¢n b·ªï message v√†o partition**

Kafka s·ª≠ d·ª•ng 3 c√°ch ƒë·ªÉ x√°c ƒë·ªãnh partition n√†o nh·∫≠n message:

### üîπ **1. Key-Based Partitioning** (Khuy·∫øn ngh·ªã)

- N·∫øu message c√≥ **key**, Kafka d√πng **hash(key) % numPartitions** ƒë·ªÉ ch·ªçn partition.
- Gi√∫p message c√≥ c√πng key lu√¥n v√†o **c√πng m·ªôt partition**.

**V√≠ d·ª•:**
```java
ProducerRecord<String, String> record = new ProducerRecord<>("order-topic", "user-123", "Order Data");
producer.send(record);
```

N·∫øu **user-123** lu√¥n hash v·ªÅ `partition-1`, th√¨ m·ªçi order c·ªßa `user-123` s·∫Ω n·∫±m trong `partition-1`.

### üîπ **2. Round-Robin Partitioning** (M·∫∑c ƒë·ªãnh)

- N·∫øu kh√¥ng c√≥ key, Kafka s·∫Ω **chia ƒë·ªÅu** message v√†o c√°c partition theo v√≤ng tr√≤n (round-robin).

### üîπ **3. Custom Partitioning**

- C√≥ th·ªÉ t·ª± ƒë·ªãnh nghƒ©a c√°ch ph√¢n chia message v√†o partition b·∫±ng c√°ch t·∫°o **Custom Partitioner**.

## ‚úÖ **Replication - ƒê·∫£m b·∫£o d·ªØ li·ªáu kh√¥ng m·∫•t**

M·ªói partition c√≥ **1 leader** v√† **nhi·ªÅu follower** (replica).

- **Producer ch·ªâ ghi v√†o leader partition**.
- **Consumer ƒë·ªçc t·ª´ leader ho·∫∑c follower**.
- N·∫øu leader b·ªã down, Kafka s·∫Ω ch·ªçn m·ªôt follower l√†m **leader m·ªõi**.

**V√≠ d·ª•:**

|Partition|Leader Broker|Follower Broker|
|---|---|---|
|`order-topic-0`|`Broker 1`|`Broker 2`|
|`order-topic-1`|`Broker 2`|`Broker 3`|
|`order-topic-2`|`Broker 3`|`Broker 1`|

## ‚úÖ **C·∫•u h√¨nh s·ªë l∆∞·ª£ng partition**

S·ªë partition c√≥ th·ªÉ ƒë∆∞·ª£c ƒë·∫∑t khi t·∫°o topic:
```bash
kafka-topics.sh --create --topic order-topic --bootstrap-server localhost:9092 --partitions 3
```
Ho·∫∑c thay ƒë·ªïi s·ªë partition sau khi t·∫°o:
```bash
kafka-topics.sh --alter --topic order-topic --bootstrap-server localhost:9092 --partitions 5
```

‚ö† **L∆∞u √Ω:**

- **TƒÉng partition ƒë∆∞·ª£c h·ªó tr·ª£**, nh∆∞ng **gi·∫£m partition kh√¥ng ƒë∆∞·ª£c h·ªó tr·ª£**.
- Khi tƒÉng partition, **message c≈© kh√¥ng t·ª± ƒë·ªông ƒë∆∞·ª£c ph√¢n ph·ªëi l·∫°i**.

## ‚úÖ **T√≥m t·∫Øt v·ªÅ Partition**

- **Partition gi√∫p Kafka scale ngang**, x·ª≠ l√Ω song song hi·ªáu qu·∫£ h∆°n.
- **Message c√≥ th·ªÉ v√†o partition d·ª±a tr√™n key, round-robin, ho·∫∑c custom logic**.
- **Replication ƒë·∫£m b·∫£o kh√¥ng m·∫•t d·ªØ li·ªáu n·∫øu broker b·ªã l·ªói**.
- **Partition kh√¥ng th·ªÉ gi·∫£m s·ªë l∆∞·ª£ng sau khi t·∫°o**



