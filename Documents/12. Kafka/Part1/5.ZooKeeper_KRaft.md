
---
## âœ… **1. ZooKeeper - CÆ¡ cháº¿ cÅ© trong Kafka**

### ğŸ”¹ **ZooKeeper lÃ  gÃ¬?**

- **ZooKeeper** lÃ  má»™t **distributed coordination service** dÃ¹ng Ä‘á»ƒ **quáº£n lÃ½ metadata vÃ  leader election** trong Kafka.
- Trong cÃ¡c phiÃªn báº£n **Kafka < 3.0**, Kafka cluster **phá»¥ thuá»™c vÃ o ZooKeeper** Ä‘á»ƒ lÆ°u trá»¯ thÃ´ng tin vá» **broker, topic, partition, consumer offsets**.

### ğŸ”¹ **Vai trÃ² cá»§a ZooKeeper trong Kafka**

1. **Quáº£n lÃ½ danh sÃ¡ch broker** (Broker nÃ o Ä‘ang online/offline).
2. **Leader Election** (Chá»n **controller node** khi cÃ³ broker má»›i tham gia hoáº·c bá»‹ lá»—i).
3. **LÆ°u metadata** cá»§a cÃ¡c topic, partition, ACLs.
4. **Theo dÃµi tráº¡ng thÃ¡i Consumer Group & Offset Management**.

### ğŸ”¹ **Cáº¥u trÃºc cá»§a ZooKeeper trong Kafka**

ZooKeeper lÆ°u trá»¯ dá»¯ liá»‡u theo dáº¡ng **ZNode (Tree Structure)**, vÃ­ dá»¥:
```
/kafka
  â”œâ”€â”€ /brokers
  â”‚    â”œâ”€â”€ /ids/[broker-1, broker-2]
  â”‚    â”œâ”€â”€ /topics/[topic-1, topic-2]
  â”‚
  â”œâ”€â”€ /controller
  â”œâ”€â”€ /admin
  â”œâ”€â”€ /consumers

```

ğŸš€ **Broker sáº½ Ä‘Äƒng kÃ½ thÃ´ng tin vÃ o ZooKeeper, vÃ  Kafka Controller sá»­ dá»¥ng thÃ´ng tin nÃ y Ä‘á»ƒ Ä‘iá»u phá»‘i cluster.**


## âœ… **2. KRaft - Kafka Raft Metadata Mode (Kafka 3.0+)**

### ğŸ”¹ **Táº¡i sao Kafka bá» ZooKeeper?**

- **ZooKeeper lÃ  má»™t dependency** â†’ Kafka cáº§n thÃªm má»™t há»‡ thá»‘ng ngoÃ i Ä‘á»ƒ quáº£n lÃ½ metadata.
- **Tá»‘c Ä‘á»™ cáº­p nháº­t metadata cháº­m** khi Kafka cluster má»Ÿ rá»™ng.
- **KhÃ³ scaling** khi cÃ³ nhiá»u broker vÃ  partition.

### ğŸ”¹ **KRaft lÃ  gÃ¬?**

- **KRaft (Kafka Raft Metadata Mode)** lÃ  **cÆ¡ cháº¿ thay tháº¿ ZooKeeper** giÃºp Kafka **tá»± quáº£n lÃ½ metadata mÃ  khÃ´ng cáº§n ZooKeeper**.
- **Sá»­ dá»¥ng thuáº­t toÃ¡n Raft** Ä‘á»ƒ quáº£n lÃ½ metadata vÃ  thá»±c hiá»‡n **leader election**.

### ğŸ”¹ **Lá»£i Ã­ch cá»§a KRaft**

âœ… **KhÃ´ng cáº§n ZooKeeper** â†’ ÄÆ¡n giáº£n hÃ³a há»‡ thá»‘ng.  
âœ… **Hiá»‡u suáº¥t cao hÆ¡n** â†’ Metadata Ä‘Æ°á»£c lÆ°u trá»¯ trá»±c tiáº¿p trong Kafka Broker.  
âœ… **TÄƒng tá»‘c Leader Election** â†’ KhÃ´ng cáº§n ZooKeeper Ä‘á»ƒ chá»n Controller.  
âœ… **TÄƒng kháº£ nÄƒng má»Ÿ rá»™ng** â†’ Há»— trá»£ nhiá»u partition hÆ¡n.

## âœ… **3. So sÃ¡nh ZooKeeper vs KRaft**

|**TiÃªu chÃ­**|**ZooKeeper (Kafka < 3.0)**|**KRaft (Kafka 3.0+)**|
|---|---|---|
|**Metadata Storage**|LÆ°u trong ZooKeeper|LÆ°u trong Kafka Broker|
|**Leader Election**|Thá»±c hiá»‡n qua ZooKeeper|DÃ¹ng thuáº­t toÃ¡n Raft|
|**Quáº£n lÃ½ Broker**|ZooKeeper theo dÃµi broker|Kafka Broker tá»± quáº£n lÃ½|
|**Tá»‘c Ä‘á»™ cáº­p nháº­t metadata**|Cháº­m khi má»Ÿ rá»™ng cluster|Nhanh hÆ¡n vÃ  hiá»‡u quáº£ hÆ¡n|
|**Kháº£ nÄƒng má»Ÿ rá»™ng**|Háº¡n cháº¿ vá»›i nhiá»u broker|Há»— trá»£ cluster lá»›n hÆ¡n|
|**Äá»™ phá»©c táº¡p**|Cáº§n cÃ i Ä‘áº·t ZooKeeper riÃªng|KhÃ´ng cáº§n ZooKeeper|

## âœ… **4. CÃ¡ch khá»Ÿi Ä‘á»™ng Kafka vá»›i KRaft**

### ğŸ”¹ **BÆ°á»›c 1: Khá»Ÿi táº¡o Metadata Directory**
```
kafka-storage.sh format -t <cluster-id> -c config/kraft/server.properties
```

ğŸ’¡ **`<cluster-id>`** cÃ³ thá»ƒ táº¡o báº±ng lá»‡nh:
```
uuidgen
```

ğŸ”¹ **BÆ°á»›c 2: Cháº¡y Kafka Broker vá»›i KRaft**
```
kafka-server-start.sh config/kraft/server.properties
```

ğŸ’¡ **KhÃ´ng cáº§n cháº¡y ZooKeeper ná»¯a!** ğŸš€


## âœ… **5. Khi nÃ o nÃªn dÃ¹ng KRaft?**

ğŸ”¹ Náº¿u báº¡n **Ä‘ang cháº¡y Kafka 3.0+**, báº¡n **nÃªn dÃ¹ng KRaft** Ä‘á»ƒ loáº¡i bá» ZooKeeper vÃ  tÄƒng hiá»‡u suáº¥t.  
ğŸ”¹ Náº¿u báº¡n **Ä‘Ã£ cÃ³ Kafka cluster dÃ¹ng ZooKeeper**, báº¡n cÃ³ thá»ƒ **chuyá»ƒn Ä‘á»•i sang KRaft** theo hÆ°á»›ng dáº«n cá»§a Kafka.


